<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Shibolet Order Sheet</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <style type="text/css">
        #orderForm section{clear: both; margin-bottom: 20px;}
        #orderForm ul{margin: 0; padding: 0;}        
        #orderForm li{
            border:1px solid #eee;
            width: 30%;
            float: left;
            position: relative;
            list-style: none;
        }

        #orderForm li.selected{background-color: #ddd;}
        #orderForm li fieldset{ border: none;}
        #orderForm img{max-width: 180px;}
        #orderForm li span{display: block;}
        #orderForm .item-select{display: none;}
        #orderForm .item-select-label{
            position: absolute;
            width: 100%;
            height: 60%;
        }
        #order-details{
            clear: both;
            padding: 30px;
            margin:30px 0 0;
        }
        .closed{background: #eee;}
        .hide{display: none;}
        </style>
    </head>
    <body>



<h1>Shibolet Inc.</h1>

<nav class="order-nav">
    <a href="#honey" data-catagory="honey">Honey</a>
    <a href="#tea" data-catagory="tea">tea</a>
    <a href="#nuts" data-catagory="nuts">nuts</a>
</nav> 

<form id="orderForm">
    <section id="honey"></section>
    <section id="tea"></section>
    <section id="nuts"></section>
</form>

<section id="order-summary">
    <h2>Order Summary</h2>
    <ul></ul>
</section>

<form id="order-details">
    <h3>Order Information:</h3>
    <fieldset>
        <span class="order-salesmen-id">
            <label>Date:</label>
            <input type="date" name="order-date" value="002">
        </span>
       <span class="order-salesmen-id">
            <label>salesmen-id</label>
            <input type="text" name="salesmen-id" value="002">
        </span>
    </fieldset>

    <fieldset>
        <span class="order-customer-name">
            <label>Customer Company</label>
            <input type="text" name="customer-name">
        </span>
    </fieldset>
    <span class="order-customer-name">
        <label>Customer Contact name</label>
        <input type="text" name="customer-name">
    </span>

    <span class="order-customer-phone">
        <label>Customer Contact phone</label>
        <input type="text" name="customer-name">
    </span>


    <span class="order-customer-address">
        <label>Customer Address</label>
        <input type="text" name="customer-name">
    </span>

    <span class="order-customer-phone">
        <label>Order needed by:</label>
        <input type="text" name="order-needed-by">
    </span>

    <span class="order-comments">
        <label>General comments:</label>
        <input type="text" name="order-comments">
    </span>


    <button>Submit Order</button>

</form>





<script src="src/jquery-3.1.1.min.js"></script>
<script src="src/microTmpl.js"></script>

<script>

// add local storage
   $(".order-nav a").on("click", function onClick() {
       jThis = $(this),
        catagory = jThis.attr("data-catagory");
        if(jThis.hasClass("loaded")) return;
        $.getJSON("data/"+catagory+".json", function(data){
            renderSection({
                catagory:catagory,
                data:data
            })
        });
   });

   $("#orderForm").on("change", ".item-select", function(){
    var jThis = $(this),
        selected = jThis.prop("checked"),
        itemEle = jThis.closest("li"),
        id = itemEle.attr("data-id");
        
       itemEle.toggleClass("selected", selected);
        if(selected){
            addToOrder({
                id:id,
                price:itemEle.find(".item-price strong").text(),
                title:itemEle.find(".item-title").text()
            });
        }else{
            removeFromOrder(id);
        }
   });

   $("#orderForm").on("click", "h1", function(){
    $(this).toggleClass("closed").next("ul").toggleClass("hide");
   });

   $("#order-summary").on("click", ".remove-item", function(){
       var id = $(this).closest("li").attr("data-id");
       removeFromOrder(id); 
        $("#orderForm").find("[data-id="+id+"]").removeClass("selected").find(".item-select").prop("checked", false);
   });

    renderSection = function renderSection(dataObj) {
        var ele = $("#"+dataObj.catagory);
        ele.html(tmpl("catagoryTmpl", dataObj));
    }

    addToOrder = function addToOrder(obj) {
        if(!orderSummary[obj.id]){
            orderSummary[obj.id] = obj;
            refreshOrderSummary();
        }
    };
    removeFromOrder = function removeFromOrder(id) {
        if(orderSummary[id]){
            delete orderSummary[id];
            refreshOrderSummary();
        }

    };

    refreshOrderSummary = function refreshOrderSummary() {
        $("#order-summary").find("ul").html(tmpl("orderSummaryTmpl", {}))
    }
    submitOrder = function submitOrder() {
        
    }

var orderSummary = {};


</script>



    <script type="tmpl" id="catagoryTmpl">
        <h1><%=catagory%></h1> 
        <ul>
            <%data.forEach(function(e){%>
                <li data-id="<%=e.id%>">
                    <fieldset>
                        <label class="item-select-label" for="select-<%=e.id%>"></label>   
                        <input class="item-select" name="<%=e.id%>" id="select-<%=e.id%>" type="checkbox">
                        <span class="item-title"><%=e.title%></span>
                        <img src="images/<%=e.image%>">
                        <span class="item-price">Price: <strong><%=e.price%></strong></span>
                        <span class="item-certification">
                            Certification: <%=e.certification%>
                        </span>
                        <span class="item-size">Size: <%=e.size%></span>
                    </fieldset>
                </li>
            <%});%> 
        </ul>
    </script>

    <script type="tmpl" id="orderSummaryTmpl">
        <ul>
            <%Object.keys(orderSummary).forEach(function(j){  var e = orderSummary[j];%>
                <li data-id="<%=e.id%>">
                    <button class="remove-item">Remove</button>
                    <fieldset>
                        <span><%=e.title%></span>
                        <span>$<%=e.price%></span>
                        <span class"item-qty">
                            Qty: <input type="number" name="qty" value="1">
                        </span>
                        <span class"item-comment">
                            comment: <input name="comment" type="text">  
                        </span>

                    </fieldset>
                </li>
            <%});%> 
        </ul>
    </script>


        <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
        <script>
            window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
            ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
        </script>
        <script src="https://www.google-analytics.com/analytics.js" async defer></script>
    </body>
</html>